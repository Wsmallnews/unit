function p({state:u,arrangeToRecursionKey:c,tableFields:d}){return{state:u,arrangeToRecursionKey:c,tableFields:d,arrangeRealIdToTempId:[],arranges:[],recursions:[],existRandoms:[],init:function(){this.initArranges(),this.initRecursions(),this.arranges||this.autoFirst(),this.buildRecursionsTable(),this.updateState(),this.$watch("arranges",(e,i)=>{this.buildRecursionsTable(),this.updateState()}),this.$watch("recursions",(e,i)=>{this.updateState()})},initArranges:function(){(this.state?.arranges??[]).forEach((i,n)=>{let s=i;s.temp_id==null||!s.temp_id?s.temp_id=this.tempRandom():this.existRandoms.push(s.temp_id);let r=[];i.children.forEach((t,a)=>{t.temp_id==null||!t.temp_id?t.temp_id=this.tempRandom():this.existRandoms.push(t.temp_id),t.id!=null&&t.id&&(this.arrangeRealIdToTempId[t.id]=t.temp_id),r.push(t)}),this.arranges.push(s)})},initRecursions:function(){(this.state?.recursions??[]).forEach((i,n)=>{let s=i;if(s.temp_id=this.tempRandom(1e7,99999999),Array.isArray(s.arrange_temp_ids)&&s.arrange_temp_ids.length>0)this.arranges.length==s.arrange_temp_ids.length&&this.recursions.push(s);else{s.arrange_temp_ids=[];let r=Array.isArray(s[this.arrangeToRecursionKey])?s[this.arrangeToRecursionKey]:s[this.arrangeToRecursionKey].split(",");r.forEach(t=>{this.arrangeRealIdToTempId[t]&&s.arrange_temp_ids.push(this.arrangeRealIdToTempId[t])}),r.length==s.arrange_temp_ids.length&&this.recursions.push(s)}})},updateState:function(){let e={};e.arranges=this.arranges,e.recursions=this.recursions,this.state=e},arrangeTemplate:function(){return{temp_id:this.tempRandom(),name:"",order_column:this.arranges.length,children:[]}},childrenArrangeTemplate:function(e){return{temp_id:this.tempRandom(),name:"",image:"",order_column:this.arranges[e].children.length}},autoFirst:function(){this.arranges=[this.arrangeTemplate()],this.arranges[0].children.push(this.childrenArrangeTemplate(0))},addArrange:function(){this.arranges.push(this.arrangeTemplate())},addChildrenArrange:function(e){this.arranges[e].children.push(this.childrenArrangeTemplate(e)),this.arranges[e].children.length==1&&(this.recursions=[])},deleteArrange:function(e){this.arranges[e].children.length&&(this.recursions=[]),this.arranges.splice(e,1)},deleteChildrenArrange:function(e,i){let n=this.arranges[e].children[i];if(this.arranges[e].children.splice(i,1),this.arranges[e].children.length<=0)this.recursions=[];else{let s=[];this.recursions.forEach((r,t)=>{r.arrange_texts.forEach((a,h)=>{a==n.name&&s.push(t)})}),s.sort(function(r,t){return t-r}),s.forEach((r,t)=>{this.recursions.splice(r,1)})}},buildRecursionsTable:function(){let e=[];this.arranges.forEach((i,n)=>{let s=i.children,r=[];s.length>0&&(s.forEach((t,a)=>{r.push(t.temp_id)}),e.push(r))}),this.recursionFunc(e)},recursionFunc:function(e,i=0,n=[]){if(i==e.length&&i!=0){let s=[],r=[];n.forEach((a,h)=>{this.arranges.forEach((l,g)=>{l.children.forEach((o,m)=>{a==o.temp_id&&(s.push(o.name),r.push(o.temp_id))})})});let t=!1;for(let a in this.recursions)if(this.recursions[a].arrange_temp_ids.sort(),r.sort(),this.recursions[a].arrange_temp_ids.join(",")==r.join(",")){t=a;break}if(t)this.recursions[t].arrange_texts=s,this.recursions[t].arrange_temp_ids=r;else{let a={temp_id:this.tempRandom(1e7,99999999),arrange_texts:s,arrange_temp_ids:r};this.tableFields.forEach(h=>{a[h.field]=h.default}),a[this.arrangeToRecursionKey]=[],this.recursions.push(a)}}e.length&&e[i]&&e[i].forEach((s,r)=>{n[i]=e[i][r],this.recursionFunc(e,i+1,n)})},tempRandom:function(e=1e6,i=9999999){let n;do n=Math.floor(Math.random()*(i-e+1))+e;while(this.existRandoms.includes(n));return this.existRandoms.push(n),n}}}export{p as default};
